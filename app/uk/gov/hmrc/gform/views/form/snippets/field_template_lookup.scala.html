@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.gform.sharedmodel.LabelHelper
@import uk.gov.hmrc.gform.sharedmodel.formtemplate.FormComponent
@import uk.gov.hmrc.gform.validation.{FormFieldValidationResult}
@import uk.gov.hmrc.gform.views.html._
@import uk.gov.hmrc.gform.views.html.form.snippets._
@import uk.gov.hmrc.gform.views.form.snippets._

@(fieldValue: FormComponent, lookup: String, options: List[LookUpOption], showAll: Boolean, prepop: Option[String], validationResult: Option[FormFieldValidationResult], index: Int, sectionTitle: String, formLevelHeading: Boolean)

@hasErrors = @{
  validationResult.exists(_.isNotOk)
}

@formGroupClass = @{
  if(hasErrors) "form-group form-group-error"
  else "form-group"
}

@inputClass = @{
  if(hasErrors) "form-control form-control-error"
  else "form-control"
}

@fieldName = @{
  fieldValue.id.value
}

@label = {
  @localisation(LabelHelper.buildRepeatingLabel(fieldValue, index))
}

 @currentValue = {
  @prepop.orElse(validationResult.flatMap(_.getCurrentValue)).getOrElse("")
}

@helpText = {
  @if(fieldValue.helpText.nonEmpty) {
    <span class="form-hint" id="@{fieldName}-hint">
      @{fieldValue.helpText}
    </span>
  } else {
    @Html("")
  }
}

@params = @{
  LookUpParams(
    id = fieldValue.id.value,
    value = currentValue,
    label = label,
    helpText = helpText,
    options = options,
    fieldValue = fieldValue,
    validationResult = validationResult,
    formLevelHeading = formLevelHeading,
    inputClasses = inputClass,
    lookup = lookup,
    showAll = showAll
  )
}

<div class="@{formGroupClass}">
  @if(options.nonEmpty) {
    @lookup_radios(params)
  } else {
    @lookup_autosuggest(params)
  }
</div>
