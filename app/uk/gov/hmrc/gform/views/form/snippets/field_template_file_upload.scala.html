@import uk.gov.hmrc.gform.sharedmodel.form._
@import uk.gov.hmrc.gform.sharedmodel.formtemplate._
@import uk.gov.hmrc.gform.controllers.routes
@import uk.gov.hmrc.play.views.html.helpers._
@import uk.gov.hmrc.gform.service.LabelHelper
@import uk.gov.hmrc.gform.validation.{FormFieldValidationResult, ValidationUtil}


@(
formId: FormId,
formTemplateId4Ga: FormTemplateId,
sectionNumber: SectionNumber,
fieldValue: FieldValue,
validationResult: Option[FormFieldValidationResult],
index: Int,
formMaxAttachmentSizeMB: Int,
totalSections: Int,
lang: Option[String]
)

@currentValue = @{
    val v = for {
        vr <- validationResult
        cv <- vr.getCurrentValue
    } yield cv

    v.getOrElse("Upload document")
}

@defaultLabel = @{"Upload document"}

<div class="form-group">

  <div class="file-uploader @if(!validationResult.forall(_.isOk)) { form-field-group--error }"
       data-form-id="@{formId}"
       data-file-id="@{fieldValue.id.value}"
       data-upload-text="@{defaultLabel}"
       data-change-text="Change document"
       data-max-file-size="@{formMaxAttachmentSizeMB * 1024 * 1024}"
       data-label="@LabelHelper.buildRepeatingLabel(fieldValue, index)"
       data-file-size-error="This document may not exceed @{formMaxAttachmentSizeMB}MB"
       data-initial-text="@if(currentValue == defaultLabel) {Upload document} else {Change document}"
       data-default-label="@{defaultLabel}"
  >

    <ul class="file-upload__file-list">
      <li class="file-upload__file-list-item">
        <a class="file-upload__file-list-item-link" href=@{
            routes.FormController.fileUploadPage(
              formId,
              formTemplateId4Ga,
              sectionNumber,
              FileId(fieldValue.id.value).value,
              totalSections,
              lang
            )
        }>
            @{currentValue}
        </a>
      </li>
    </ul>

    <div class="file-upload__errors">
      @{
          val map: Map[String, Set[String]] = validationResult.map(x => ValidationUtil.renderErrors("", x)).getOrElse(Map.empty)
          val errors: Set[String] = ValidationUtil.printErrors(map)
          errors.map(e => errorInline(e, e, Seq("")))
      }
    </div>
  </div>
</div>
