@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.govukfrontend.views.html.components.FormWithCSRF
@import uk.gov.hmrc.gform.sharedmodel.AccessCode
@import uk.gov.hmrc.gform.sharedmodel.formtemplate.{ SectionNumber, FormTemplate }
@import uk.gov.hmrc.gform.config.FrontendAppConfig
@import uk.gov.hmrc.gform.gform.{HasErrors, NoErrors}
@import uk.gov.hmrc.govukfrontend.views.viewmodels.summarylist.{ SummaryList }
@import uk.gov.hmrc.gform.views.html.main_template
@import uk.gov.hmrc.gform.controllers.{ SaveAndExit, SaveAndContinue }
@import uk.gov.hmrc.gform.models.FastForward
@import uk.gov.hmrc.hmrcfrontend.views.html.components.HmrcPageHeading
@import uk.gov.hmrc.hmrcfrontend.views.viewmodels.pageheading.PageHeading

@(
    title: String,
    caption: Option[String],
    noPIITitle: String,
    formTemplate: FormTemplate,
    maybeAccessCode: Option[AccessCode],
    sectionNumber: SectionNumber,
    summaryListRows: List[SummaryList],
    frontendAppConfig: FrontendAppConfig,
    continueButtonLabel: String,
    renderComeBackLater: Boolean,
    pageLevelError: HasErrors = NoErrors,
    header: Option[Html],
    footer: Option[Html],
    specimenNavigation: Html,
    fastForward: List[FastForward],
    notificationBanner: Option[NotificationBanner]
)(implicit request: Request[_], messages: Messages, l:LangADT, evaluator: SmartStringEvaluator)

@formWithCSRF = @{new FormWithCSRF()}
@govukButton = @{new GovukButton()}
@govukSummaryList = @{new GovukSummaryList()}
@heading = @{ title }
@formAction = @{ uk.gov.hmrc.gform.gform.routes.FormController.updateFormData(formTemplate._id, maybeAccessCode, sectionNumber, fastForward, SaveAndContinue) }
@hmrcPageHeading = @{new HmrcPageHeading()}
@globalGovukNotificationBanner = @{new GovukNotificationBanner()}

@backLink = @{
  new BackLink(href = uk.gov.hmrc.gform.gform.routes.FormController.backAction(formTemplate._id, maybeAccessCode, sectionNumber, fastForward).path,
               content = new Text(messages("linkText.back")))
}
@main_template(
    title = noPIITitle,
    formTemplate = formTemplate,
    containsErrors = pageLevelError.hasErrors,
    frontendAppConfig = frontendAppConfig,
    backLink = Some(backLink)
) {
    @notificationBanner.fold(HtmlFormat.empty)(notificationBanner => globalGovukNotificationBanner(notificationBanner))

    @hmrcPageHeading(PageHeading(
        text = heading,
        headingClasses = Some("govuk-heading-l"),
        section = caption,
        captionClasses = Some("govuk-caption-l")
    ))

    @header.map{ h =>
        <div class="govuk-body">
            @h
        </div>
    }

    <div class="govuk-body">
        @summaryListRows.map { l =>
            @l.attributes.find(_._1 == "title").map{attribute =>
              <h2 class="govuk-heading-m govuk-!-margin-top-5">@attribute._2</h2>
            }
            @govukSummaryList(l)
        }
    </div>

    @footer.map{ f =>
        <div class="govuk-body">
            @f
        </div>
    }

    @formWithCSRF(action = formAction, args = 'class -> "js-form", 'autocomplete -> "on", 'novalidate -> "novalidate", 'id -> "gf-form") {
        @govukButton(Button(content = Text(continueButtonLabel),
                inputType=Some("submit"),
                name=Some("save")
            )
        )
        @if(renderComeBackLater) {
                @govukButton(Button(content = Text(messages("linkText.saveAndComeBackLater")),
                    inputType=Some("submit"),
                    attributes = Map("formaction" -> uk.gov.hmrc.gform.gform.routes.FormController.updateFormData(formTemplate._id, maybeAccessCode, sectionNumber, List(FastForward.StopAt(sectionNumber)), SaveAndExit).path),
                    classes="govuk-button--secondary"
                )
            )
        }
    }
    @specimenNavigation
}
